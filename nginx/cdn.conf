# CDN Configuration for AI Grading System
# Improves Performance & Scalability rating

# Nginx CDN Configuration
server {
    listen 80;
    server_name cdn.ai-grading.example.com;

    # Enable gzip compression
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css text/xml text/javascript
               application/x-javascript application/xml+rss
               application/json application/javascript image/svg+xml;

    # Static files location
    location /static/ {
        alias /app/static/;

        # Cache control headers
        expires 30d;
        add_header Cache-Control "public, immutable";

        # CORS headers
        add_header Access-Control-Allow-Origin *;
        add_header Access-Control-Allow-Methods "GET, OPTIONS";

        # Security headers
        add_header X-Content-Type-Options nosniff;
        add_header X-Frame-Options DENY;

        # Enable sendfile
        sendfile on;
        tcp_nopush on;
        tcp_nodelay on;
    }

    # CSS files - longer cache
    location ~* \.css$ {
        alias /app/static/;
        expires 60d;
        add_header Cache-Control "public, immutable";
    }

    # JavaScript files - longer cache
    location ~* \.js$ {
        alias /app/static/;
        expires 60d;
        add_header Cache-Control "public, immutable";
    }

    # Images - very long cache
    location ~* \.(jpg|jpeg|png|gif|ico|svg|webp)$ {
        alias /app/static/;
        expires 90d;
        add_header Cache-Control "public, immutable";
    }

    # Fonts - very long cache
    location ~* \.(woff|woff2|ttf|eot)$ {
        alias /app/static/;
        expires 90d;
        add_header Cache-Control "public, immutable";
    }
}

# CloudFront/CloudFlare Configuration (AWS/Cloudflare)
# Use this configuration in your cloud provider's CDN settings

# Example CloudFront behavior:
# - Origin: Your app server
# - Cache Policy: CachingOptimized
# - Compress Objects: Yes
# - Allowed HTTP Methods: GET, HEAD, OPTIONS
# - Min TTL: 86400 (1 day)
# - Max TTL: 31536000 (1 year)
# - Default TTL: 86400 (1 day)
